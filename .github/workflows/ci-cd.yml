name: CICD pipeline

on:
    pull_request:
        branches:
            - main

jobs:
    run-check:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout code
          uses: actions/checkout@v2
  
        - name: Set up Python
          uses: actions/setup-python@v2
          with:
            python-version: '3.x'
  
        - name: Install dependencies
          run: |
            python -m pip install --upgrade pip
  
        - name: Run the program
          run: |
            python api/main.py
  
    lint:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code # Voor ophalen van code
              uses: actions/checkout@v3

            - name: Set up Python # Voor installeren van Python
              uses: actions/setup-python@v3
              with:
                python-version: '3.13'

            - name: Install dependencies # Voor installeren van dependencies
              run: pip install -r requirements.txt

            - name: Run Pylint # Voor Pylint runnen op alle files
              run: pylint **/*.py

    test:
        name: Run Unit Tests 
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code 
              uses: actions/checkout@v3

            - name: Set up Python
              uses: actions/setup-python@v3
              with:
                python-version: '3.13'

            - name: Install dependencies
              run: pip install -r requirements.txt

            - name: Run tests 
              run: python -m unittest Warehousing.tests.test_management


    deploy:
        name: Deploy Application
        runs-on: ubuntu-latest
        needs: test
        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Set up Python
              uses: actions/setup-python@v3
              with:
                python-version: '3.13'

            - name: Install dependencies
              run: pip install -r requirements.txt

            - name: Build Docker image
              run: docker build -t warehousing .

            - name: Push Docker image to registry
              run: docker push warehousing:latest
            
            - name: Deploy to Server
              run: 

                